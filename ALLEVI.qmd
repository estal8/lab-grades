---
title: "ALLEVI"
author: "Esther Allevi"
format: html
---

Here is the link to the github repository : https://github.com/estal8/lab-grades.git

## Introduction

### Study organisation

```{r}
#|message : false
library(here)
library(vroom)
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
```


#### Question 1

```{r}
here::i_am("lab-grades.Rproj")
```

```{r}
courses <- vroom("courses.csv")
```

#### Question 2 

```{r}
courses |>
  rename(`course name` = course, "identifier" = course_id, `number of exams`= "nb_grades") |>
  knitr::kable()
```

### Students

#### Question 3

```{r}
students <- vroom("students.csv")
```

```{r}
# Checking the types
cols_type = cols(
  id = col_double(),
  group = col_double(),
  birth_date = col_date(format = ""),
  sex = col_character(),
  .delim = ","
)
```

```{r}
students <- students |>
  mutate(
    id = as.integer(id),
    group = as.factor(group),
    sex = as.factor(sex)
  )
```

```{r}
typeof(students$group) # checking
class(students$birth_date)
```

The `{r} "birth_date"` column of the `{r} "students"` data frame is of class `{r} class(students$birth_date)`.

**PROBLÃˆME RENDERING**

### Grades

```{r}
# Check, not sure if properly cleaned
grades_clean <- read_delim(here("grades.csv"),
  delim = ";",
  na = "$")
```

## Student population analysis

#### Question 5

```{r}
students |>
  summarise(`Number of students per group` = n(), .by = group) |>
  ggplot(aes(x = group, y = `Number of students per group`)) + 
    geom_col() 
```

#### Question 6

```{r}
students |>
    summarise(`Number of students per group` = n(), .by = c(group, sex)) |>
  ggplot(aes(x = group, y = `Number of students per group`, fill = sex)) + 
    geom_col() 
```

#### Question 7

```{r}
students |>
  mutate(age = as.numeric(Sys.Date() - birth_date) / 365) |>
  ggplot(aes(x = age)) +
    geom_density(bw = "sj") +
    geom_rug(alpha = 0.2) # or geom_histogram(binwidth = 1) ???
```

#### Question 8

```{r}
students |>
  mutate(age = as.numeric(Sys.Date() - birth_date) / 365) |>
  summarise(`Median age` = as.integer(median(age)), .by = group) |>
  arrange(group)
```

#### Question 9

```{r}
# id, sex and age of the oldest student per group
students |>
  mutate(age = as.numeric(Sys.Date() - birth_date) / 365) |>
  arrange(desc(age)) |>
  slice(1, .by = group) |>
  select(id, group, sex) |>
  arrange(group) |>
  knitr::kable()
```

## Simple grade analysis

#### Question 10

The data set contains `{r} grades_clean |> filter(!is.na(grade)) |> nrow()` grades.

#### Question 11

```{r}
# merging the databases grades, students and courses
students_grades <- 
  left_join(students, grades_clean, by = join_by(id))

students_grades_courses <-
  left_join(students_grades, courses, by = join_by(course_id))
```

```{r}
# average of all the grades in Language and Linguistics per group + graph (this as a function of the group)
students_grades_courses |>
  filter(course == "Language and Linguistics") |>
  summarise(avg_grades = mean(grade, na.rm = TRUE), .by = group) |>
  arrange(group) ## Weird values ???
```

#### Question 12

Take all grades in a semester an compare the distribution of the grades to see if one module is simpler.

```{r}
students_grades_courses |>
  filter(!is.na(grade)) |>
  ggplot(aes(x = as.factor(module), y = grade)) +
  geom_boxplot()
```

## Attendance analysis

#### Question 13

```{r}
# number fo grade per student
students_grades_courses |>
  summarise(nb_grades = n(), .by = id) |>
  slice_head(n = 5) |>
  knitr::kable()
```

#### Question 14 

```{r}
# distribution of the number of grades for female and male students

students_grades_courses |>
  filter(!is.na(grade)) |>
  summarise(nb_grades = n(), .by = c(id, sex)) |>
  ggplot(aes(y = nb_grades, fill = sex)) +
  geom_bar()
# scale integers ????
```

#### Question 15

```{r}
df_15 <- students_grades_courses |>
  filter(course == "Buddhist Philosophy and Meditation") |>
  select(id, group, grade) |>
  summarise(nb_grades = n(), .by = c(id, group))

df_15 |>
  slice_head(n=5) |>
  knitr::kable()
```

#### Question 16

```{r}
# represent the nb of students who have the same nb of grades

df_15 |>
  ggplot(aes(x = nb_grades)) +
  geom_bar()
```

#### Question 17

```{r}
# study whether the number of grades per student depends on the group

df_15 |>
  ggplot(aes(x = nb_grades, fill = group)) +
  geom_bar(position = "dodge")
```

#### Question 18

```{r}
df_15_with_sex <- students_grades_courses |>
  filter(course == "Buddhist Philosophy and Meditation") |>
  select(id, group, grade, sex) |>
  summarise(nb_grades = n(), .by = c(id, group, sex))
```

```{r}
df_15_with_sex |>
  ggplot(aes(x = nb_grades, fill = group)) +
  geom_bar(position = "dodge") +
  facet_wrap(vars(sex))
```





